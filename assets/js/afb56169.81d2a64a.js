"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4940],{12732:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>l,metadata:()=>c,toc:()=>u});var r=t(17624),a=t(4552),i=t(61268),o=t(87768);const l={id:"fullnode-setup",title:"Set Up a KILT Full Node"},s=void 0,c={id:"develop/chain/fullnode-setup",title:"Set Up a KILT Full Node",description:"We will guide you through the process of setting up and connecting to a KILT full node.",source:"@site/docs/develop/02_chain/04_fullnode.md",sourceDirName:"develop/02_chain",slug:"/develop/chain/fullnode-setup",permalink:"/docs/develop/chain/fullnode-setup",draft:!1,unlisted:!1,editUrl:"https://github.com/KILTprotocol/docs/edit/master/docs/develop/02_chain/04_fullnode.md",tags:[],version:"current",lastUpdatedAt:1717145747,formattedLastUpdatedAt:"May 31, 2024",sidebarPosition:4,frontMatter:{id:"fullnode-setup",title:"Set Up a KILT Full Node"},sidebar:"chain",previous:{title:"Deployments and Services",permalink:"/docs/develop/chain/deployments"}},d={},u=[{value:"Setup",id:"setup",level:2},{value:"WASM Runtime Execution",id:"wasm-runtime-execution",level:3},{value:"Specify the Right Chainspec",id:"specify-the-right-chainspec",level:3},{value:"Specify the Blockchain Storage Path",id:"specify-the-blockchain-storage-path",level:3},{value:"Join the Network",id:"join-the-network",level:2},{value:"Build the Full Node",id:"build-the-full-node",level:3},{value:"Run an Archive Node",id:"run-an-archive-node",level:3},{value:"Run an Archive Node",id:"run-an-archive-node-1",level:3},{value:"Sync the Blockchain State",id:"sync-the-blockchain-state",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.M)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["We will guide you through the process of setting up and connecting to a KILT full node.\nIn contrast ",(0,r.jsx)(n.a,{href:"/docs/participate/staking/become_a_collator/setup-node",children:"to a collator"}),", full nodes do not author blocks.\nThey act as a backend for websites and help to verify new blocks or validate extrinsics (e.g., coin transfers and other transactions) directly on the network without relying on a centralized infrastructure provider."]}),"\n",(0,r.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,r.jsx)(n.p,{children:"There are currently two different runtimes (i.e., two different parachain environments) that a KILT full node can be part of:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Spiritnet"}),": the official public network, which contains only stable and thoroughly-tested features"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Peregrine"}),": the public test network whose runtime is as close to that of Spiritnet as possible. It can be used to test applications that use KILT before connecting them to the production Spiritnet chain, which requires tokens that have real monetary value"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Each runtime has its own benchmark measurements."}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["The remainder of this guide will focus on the official ",(0,r.jsx)(n.strong,{children:"Spiritnet"}),".\nNevertheless, we recommend trying out the setup on our Peregrine testnet first.\nHence, at each step where it is applicable, we indicate what differs between the Peregrine and Spiritnet configuration for the full node to join either network."]})}),"\n",(0,r.jsx)(n.h3,{id:"wasm-runtime-execution",children:"WASM Runtime Execution"}),"\n",(0,r.jsxs)(n.p,{children:["A KILT full node should use the ",(0,r.jsx)(n.code,{children:"--execution=wasm"})," parameter for both the Relay Chain and parachain collation.\nThe alternative to WASM runtime execution is native runtime execution, which might be faster but can, in some cases, deviate from the WASM execution logic and result in a different state.\nWhen this happens, the full node will crash and will stop synchronizing with the network.\nSince the WASM runtime logic is part of the blockchain state itself and hence represents the single source of truth, all nodes should execute the WASM version of the runtime logic."]}),"\n",(0,r.jsx)(n.h3,{id:"specify-the-right-chainspec",children:"Specify the Right Chainspec"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"--chain"})," parameter indicates which blockchain the KILT full node will join.\nThis parameter must be specified for both the parachain ",(0,r.jsx)(n.strong,{children:"and"})," the Relay Chain, since both chains are, as a matter of fact, separate blockchains.\nThe KILT parachain accepts an additional parameter to select the environment to use for the WASM runtime execution.\nThis can either be ",(0,r.jsx)(n.code,{children:"peregrine"})," or ",(0,r.jsx)(n.code,{children:"spiritnet"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Hence, to start a full node for the Spiritnet network, the parameter would be ",(0,r.jsx)(n.code,{children:"--chain=spiritnet"}),".\nUnfortunately, there is no hardcoded chain spec for the Peregrine network, so the full path of the chainspec file must be provided ",(0,r.jsx)(n.code,{children:"--chain=/node/dev-specs/kilt-parachain/peregrine-kilt.json"}),".\nPlease refer to the ",(0,r.jsx)(n.a,{href:"https://github.com/KILTprotocol/kilt-node/blob/master/dev-specs/kilt-parachain/peregrine-kilt.json",children:"KILT node repository"})," or the ",(0,r.jsx)(n.a,{href:"https://hub.docker.com/r/kiltprotocol/kilt-node/tags",children:"Docker image"})," for more information."]}),"\n",(0,r.jsx)(n.h3,{id:"specify-the-blockchain-storage-path",children:"Specify the Blockchain Storage Path"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"--base-path"})," parameter specifies where all the persistent files must be stored.\nBy default, the session keys will also be stored in the ",(0,r.jsx)(n.em,{children:"base path"}),", but we recommend separating them from the other files.\nThis makes sure that the keyfiles are not accidentally lost or published when the blockchain database is either backed up or restored.\nYou can configure where to store the session keys using the ",(0,r.jsx)(n.code,{children:"--keystore-path"})," option.\nSince the collator will collate only for the parachain, there is no need to add this to the Relay Chain part of the command."]}),"\n",(0,r.jsx)(n.h2,{id:"join-the-network",children:"Join the Network"}),"\n",(0,r.jsxs)(i.c,{groupId:"exec-strategy",defaultValue:"Binary",values:[{label:"Binary",value:"Binary"},{label:"Docker",value:"Docker"}],children:[(0,r.jsxs)(o.c,{value:"Binary",children:[(0,r.jsx)(n.h3,{id:"build-the-full-node",children:"Build the Full Node"}),(0,r.jsxs)(n.p,{children:["In order to build the KILT full node executable, you need to have ",(0,r.jsx)(n.a,{href:"https://www.rust-lang.org/tools/install",children:"rustup and Rust installed"}),".\nAfter cloning the repository, you can build the executable by running the ",(0,r.jsx)(n.code,{children:"cargo build"})," command below from the root directory."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Clone the repository\ngit clone https://github.com/KILTprotocol/kilt-node.git\n# Check out master branch\ngit checkout master\n# Build the executable from source enabling all the optimizations with --release.\ncargo build --release -p kilt-parachain\n"})}),(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["You must not use the default ",(0,r.jsx)(n.code,{children:"develop"})," branch to build the executable.\nInstead, the ",(0,r.jsx)(n.a,{href:"https://github.com/KILTprotocol/kilt-node/releases",children:"latest release"})," from ",(0,r.jsx)(n.code,{children:"master"})," should be used."]})}),(0,r.jsxs)(n.p,{children:["The compiled executable can be found in ",(0,r.jsx)(n.code,{children:"./target/release/kilt-parachain"})," after the build process completes successfully."]}),(0,r.jsx)(n.h3,{id:"run-an-archive-node",children:"Run an Archive Node"}),(0,r.jsxs)(n.p,{children:["To run an Archive full node, add the option ",(0,r.jsx)(n.code,{children:"--pruning archive"})," to the command."]}),(0,r.jsxs)(i.c,{groupId:"runtime",defaultValue:"Spiritnet",values:[{label:"Spiritnet",value:"Spiritnet"},{label:"Peregrine",value:"Peregrine"}],children:[(0,r.jsx)(o.c,{value:"Spiritnet",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./target/release/kilt-parachain \\\n  --chain=spiritnet \\\n  --runtime=spiritnet \\\n  --rpc-port=9944 \\\n  --rpc-cors=all \\\n  --rpc-external \\\n  --name="name of full node" \\\n  --execution=wasm \\\n  --pruning archive \\\n  -- \\\n  --chain=polkadot \\\n  --execution=wasm\n'})})}),(0,r.jsx)(o.c,{value:"Peregrine",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'./target/release/kilt-parachain \\\n  --chain=/node/dev-specs/kilt-parachain/peregrine-kilt.json \\\n  --runtime=peregrine \\\n  --rpc-port=9944 \\\n  --rpc-cors=all \\\n  --rpc-external \\\n  --name="name of full node" \\\n  --execution=wasm \\\n  --pruning archive \\\n  -- \\\n  --chain=/node/dev-specs/kilt-parachain/peregrine-relay.json \\\n  --execution=wasm\n'})})})]})]}),(0,r.jsxs)(o.c,{value:"Docker",children:[(0,r.jsx)(n.h3,{id:"run-an-archive-node-1",children:"Run an Archive Node"}),(0,r.jsxs)(n.p,{children:["The full node can also be started as a Docker container.\nTo expose the WebSockets ensure that the ",(0,r.jsx)(n.code,{children:"--rpc-external"})," flags is set."]}),(0,r.jsxs)(n.p,{children:["To run an Archive full node add the option ",(0,r.jsx)(n.code,{children:"--pruning archive"})," to the command."]}),(0,r.jsx)(n.p,{children:"First, you can fetch the latest pre-built image:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker pull kiltprotocol/kilt-node:latest\n"})}),(0,r.jsx)(n.p,{children:"Once you have the image, you can spin up the container.\nMake sure to choose whether you want to start a full node for Peregrine or Spiritnet by selecting the correct runtime and chain."}),(0,r.jsxs)(i.c,{groupId:"runtime",defaultValue:"Spiritnet",values:[{label:"Spiritnet",value:"Spiritnet"},{label:"Peregrine",value:"Peregrine"}],children:[(0,r.jsx)(o.c,{value:"Spiritnet",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'docker run -v kilt-node-data:/data kiltprotocol/kilt-node:latest \\\n  --base-path=/data/para \\\n  --chain=spiritnet \\\n  --runtime=spiritnet \\\n  --rpc-port=9944 \\\n  --rpc-cors=all \\\n  --rpc-external \\\n  --name="name of full node" \\\n  --execution=wasm \\\n  --pruning archive \\\n  -- \\\n  --base-path=/data/relay \\\n  --chain=polkadot \\\n  --execution=wasm\n'})})}),(0,r.jsx)(o.c,{value:"Peregrine",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'docker run -v kilt-node-data:/data kiltprotocol/kilt-node:latest \\\n  --base-path=/data/para \\\n  --chain=/node/dev-specs/kilt-parachain/peregrine-kilt.json \\\n  --runtime=peregrine \\\n  --rpc-port=9944 \\\n  --rpc-cors=all \\\n  --rpc-external \\\n  --name="name of full node" \\\n  --execution=wasm \\\n  --pruning archive \\\n  -- \\\n  --base-path=/data/relay \\\n  --chain=/node/dev-specs/kilt-parachain/peregrine-relay.json \\\n  --execution=wasm\n'})})})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"sync-the-blockchain-state",children:"Sync the Blockchain State"}),"\n",(0,r.jsxs)(n.p,{children:["Once started, the full node needs to fully sync up with both the parachain and the Relay Chain states.\nDepending on the size of both blockchain states and the node hardware specs, it may take from a number of hours to a few days for the node to fully synchronize.\nMore details can be found in the ",(0,r.jsx)(n.a,{href:"https://wiki.polkadot.network/docs/maintain-guides-how-to-validate-polkadot#synchronize-chain-data",children:"Polkadot network documentation"}),"."]}),"\n",(0,r.jsx)(n.admonition,{title:"Example of node sync",type:"note",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-Example",metastring:"of node sync",children:"2021-06-17 02:34:34 \ud83d\udd0d Discovered new external address for our node: /ip4/100.102.231.64/tcp/30333/ws/p2p/12D3KooWLE7ivpuXJQpFVP4fuuutAqEsk8nrNEpuR3tddqnXgLPB\n2021-06-17 02:34:36 \u2699\ufe0f  Syncing 409.2 bps, target=#8062689 (5 peers), best: #3477 (0x63ad\u2026e046), finalized #3072 (0x0e4c\u2026f587), \u2b07 153.2kiB/s \u2b06 12.9kiB/s\n2021-06-17 02:34:37 \ud83d\udd0d Discovered new external address for our node: /ip4/100.111.175.0/tcp/30333/ws/p2p/12D3KooWLE7ivpuXJQpFVP4fuuutAqEsk8nrNEpuR3tddqnXgLPB\n2021-06-17 02:34:38 \ud83d\udd0d Discovered new external address for our node: /ip4/100.100.176.0/tcp/30333/ws/p2p/12D3KooWLE7ivpuXJQpFVP4fuuutAqEsk8nrNEpuR3tddqnXgLPB\n2021-06-17 02:34:41 \u2699\ufe0f  Syncing 386.2 bps, target=#8062690 (7 peers), best: #5409 (0x1d76\u20268c3d), finalized #5121 (0x8ad1\u2026b6dc), \u2b07 96.1kiB/s \u2b06 10.9kiB/s\n2021-06-17 02:34:46 \u2699\ufe0f  Syncing 394.8 bps, target=#8062691 (11 peers), best: #7383 (0x0689\u20266f1e), finalized #7168 (0x72a9\u20268d8c), \u2b07 352.9kiB/s \u2b06 5.1kiB/s\n2021-06-17 02:34:51 \u2699\ufe0f  Syncing 347.0 bps, target=#8062692 (12 peers), best: #9118 (0x66fc\u2026cce3), finalized #8704 (0x14c9\u2026705e), \u2b07 62.7kiB/s \u2b06 1.7kiB/s\n"})})})]})}function p(e={}){const{wrapper:n}={...(0,a.M)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},87768:(e,n,t)=>{t.d(n,{c:()=>o});t(11504);var r=t(65456);const a={tabItem:"tabItem_Ymn6"};var i=t(17624);function o(e){let{children:n,hidden:t,className:o}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.c)(a.tabItem,o),hidden:t,children:n})}},61268:(e,n,t)=>{t.d(n,{c:()=>y});var r=t(11504),a=t(65456),i=t(53943),o=t(55592),l=t(95288),s=t(10632),c=t(27128),d=t(21148);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:a}}=e;return{value:n,label:t,attributes:r,default:a}}))}(t);return function(e){const n=(0,c.w)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function f(e){let{queryString:n=!1,groupId:t}=e;const a=(0,o.Uz)(),i=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,s._M)(i),(0,r.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(a.location.search);n.set(i,e),a.replace({...a.location,search:n.toString()})}),[i,a])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,i=h(e),[o,s]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:i}))),[c,u]=f({queryString:t,groupId:a}),[m,b]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,i]=(0,d.IN)(t);return[a,(0,r.useCallback)((e=>{t&&i.set(e)}),[t,i])]}({groupId:a}),g=(()=>{const e=c??m;return p({value:e,tabValues:i})?e:null})();(0,l.c)((()=>{g&&s(g)}),[g]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);s(e),u(e),b(e)}),[u,b,i]),tabValues:i}}var b=t(93664);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=t(17624);function v(e){let{className:n,block:t,selectedValue:r,selectValue:o,tabValues:l}=e;const s=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.MV)(),d=e=>{const n=e.currentTarget,t=s.indexOf(n),a=l[t].value;a!==r&&(c(n),o(a))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=s.indexOf(e.currentTarget)+1;n=s[t]??s[0];break}case"ArrowLeft":{const t=s.indexOf(e.currentTarget)-1;n=s[t]??s[s.length-1];break}}n?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.c)("tabs",{"tabs--block":t},n),children:l.map((e=>{let{value:n,label:t,attributes:i}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>s.push(e),onKeyDown:u,onClick:d,...i,className:(0,a.c)("tabs__item",g.tabItem,i?.className,{"tabs__item--active":r===n}),children:t??n},n)}))})}function k(e){let{lazy:n,children:t,selectedValue:a}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function j(e){const n=m(e);return(0,x.jsxs)("div",{className:(0,a.c)("tabs-container",g.tabList),children:[(0,x.jsx)(v,{...e,...n}),(0,x.jsx)(k,{...e,...n})]})}function y(e){const n=(0,b.c)();return(0,x.jsx)(j,{...e,children:u(e.children)},String(n))}},4552:(e,n,t)=>{t.d(n,{I:()=>l,M:()=>o});var r=t(11504);const a={},i=r.createContext(a);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);