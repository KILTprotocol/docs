(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2068],{48952:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=48952,e.exports=t},14548:(e,t,n)=>{"use strict";n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>m,frontMatter:()=>d,metadata:()=>h,toc:()=>p});var i=n(17624),s=n(4552),o=(n(1608),n(96020)),a=(n(73484),n(61268)),c=n(87768);const r="import * as Kilt from '@kiltprotocol/sdk-js'\nimport { config as envConfig } from 'dotenv'\nimport { generateAccount } from './generateAccount'\n\nexport async function createFullDid(\n  creatorAccount: Kilt.KiltKeyringPair & {\n    type: 'ed25519' | 'sr25519' | 'ecdsa'\n  }\n): Promise<{\n  fullDid: Kilt.DidDocument\n}> {\n  const api = Kilt.ConfigService.get('api')\n\n  const verificationMethod = Kilt.Did.publicKeyToChain(creatorAccount)\n\n  const txs = [\n    api.tx.did.createFromAccount(verificationMethod),\n    api.tx.did.dispatchAs(\n      creatorAccount.address,\n      api.tx.did.setAttestationKey(verificationMethod)\n    )\n  ]\n\n  console.log('Creating DID from account\u2026')\n  await Kilt.Blockchain.signAndSubmitTx(\n    api.tx.utility.batch(txs),\n    creatorAccount\n  )\n  const didUri = Kilt.Did.getFullDidUriFromKey(creatorAccount)\n  const encodedFullDid = await api.call.did.query(Kilt.Did.toChain(didUri))\n  const { document: didDocument } = Kilt.Did.linkedInfoFromChain(encodedFullDid)\n\n  if (!didDocument) {\n    throw new Error('Full DID was not successfully created.')\n  }\n\n  return { fullDid: didDocument }\n}\n\n// Don't execute if this is imported by another file.\nif (require.main === module) {\n  ;(async () => {\n    envConfig()\n\n    try {\n      await Kilt.connect(process.env.WSS_ADDRESS as string)\n\n      // Load attester account\n      const accountMnemonic = process.env.ATTESTER_ACCOUNT_MNEMONIC as string\n      const { account } = generateAccount(accountMnemonic)\n      const { fullDid } = await createFullDid(account)\n\n      console.log('\\nsave following to .env to continue\\n')\n      console.error(`ATTESTER_DID_URI=\"${fullDid.uri}\"\\n`)\n    } catch (e) {\n      console.log('Error while creating attester DID')\n      throw e\n    }\n  })()\n}\n",d={id:"did",title:"DID"},l=void 0,h={id:"develop/workshop/attester/did",title:"DID",description:"The next step is to generate a KILT decentralized identifier (DID) using the account you created for the Attester in the previous step.",source:"@site/docs/develop/03_workshop/04_attester/02_did.md",sourceDirName:"develop/03_workshop/04_attester",slug:"/develop/workshop/attester/did",permalink:"/docs/develop/workshop/attester/did",draft:!1,unlisted:!1,editUrl:"https://github.com/KILTprotocol/docs/edit/master/docs/develop/03_workshop/04_attester/02_did.md",tags:[],version:"current",lastUpdatedAt:1713371933,formattedLastUpdatedAt:"Apr 17, 2024",sidebarPosition:2,frontMatter:{id:"did",title:"DID"},sidebar:"workshop",previous:{title:"Account",permalink:"/docs/develop/workshop/attester/account"},next:{title:"CType",permalink:"/docs/develop/workshop/attester/ctype"}},u={},p=[{value:"Light and full DIDs",id:"light-and-full-dids",level:2},{value:"What&#39;s the difference between a DID and an account?",id:"whats-the-difference-between-a-did-and-an-account",level:2},{value:"Create a DID",id:"create-a-did",level:2},{value:"Write DID to chain",id:"write-did-to-chain",level:3},{value:"Run the code",id:"run-the-code",level:2}];function D(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["The next step is to generate a KILT decentralized identifier (DID) using the account you created for the ",(0,i.jsx)("span",{className:"label-role attester",children:"Attester"})," in ",(0,i.jsx)(t.a,{href:"/docs/develop/workshop/attester/account",children:"the previous step"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"A DID may represent any entity, such as a person, an organization, or a machine."}),"\n",(0,i.jsx)(t.p,{children:"A DID is a string uniquely identifying each KILT user.\nYou can store information about a DID on the KILT chain, which is useful for different use cases."}),"\n",(0,i.jsx)(t.p,{children:"One use case is messaging.\nYou could store a public encryption key and a service on chain, and a user can query both using a DID.\nOther users can now encrypt messages using your public encryption key and send a message to your service."}),"\n",(0,i.jsx)(t.h2,{id:"light-and-full-dids",children:"Light and full DIDs"}),"\n",(0,i.jsxs)(t.p,{children:["Kilt supports two DID types: ",(0,i.jsx)(t.strong,{children:"light"})," and ",(0,i.jsx)(t.strong,{children:"full"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["There are differences between the two types, but the most crucial is that you can use a light DID offline, but a full DID needs access to the blockchain to work.\nRead the ",(0,i.jsx)(t.a,{href:"/docs/develop/sdk/cookbook/dids/light-did-creation",children:"DID documentation"})," to learn more about the difference between the light and full types."]}),"\n",(0,i.jsxs)(t.admonition,{title:"KILT DID",type:"info",children:[(0,i.jsx)(t.p,{children:"A DID supports four different key types:"}),(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["An ",(0,i.jsx)(t.em,{children:"authentication key pair"}),", used to sign claims and present authenticated credentials"]}),"\n",(0,i.jsxs)(t.li,{children:["A ",(0,i.jsx)(t.em,{children:"key-agreement key pair"}),", used to encrypt/decrypt messages"]}),"\n",(0,i.jsxs)(t.li,{children:["An ",(0,i.jsx)(t.em,{children:"assertion-method key pair"}),", used to write CTypes and attestations on chain"]}),"\n",(0,i.jsxs)(t.li,{children:["A ",(0,i.jsx)(t.em,{children:"capability-delegation key pair"}),", used to write delegations on chain"]}),"\n"]}),(0,i.jsx)(t.p,{children:"You can replace keys over time, e.g., if a key becomes compromised."})]}),"\n",(0,i.jsx)(t.h2,{id:"whats-the-difference-between-a-did-and-an-account",children:"What's the difference between a DID and an account?"}),"\n",(0,i.jsx)(t.p,{children:"A DID and an account sound quite similar, but there are some differences:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"You record both to chain"}),"\n",(0,i.jsx)(t.li,{children:"You can have a DID without an account"}),"\n",(0,i.jsx)(t.li,{children:"You can have an account without a DID"}),"\n",(0,i.jsx)(t.li,{children:"Only an account can pay deposits and fees and attest claims"}),"\n",(0,i.jsx)(t.li,{children:"DIDs don't hold any coins"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"In summary, you register a DID on the blockchain by an account submitting the DID creation transaction and paying the fees."}),"\n",(0,i.jsx)(t.h2,{id:"create-a-did",children:"Create a DID"}),"\n",(0,i.jsxs)(t.p,{children:["As an ",(0,i.jsx)("span",{className:"label-role attester",children:"Attester"})," needs to interact with the chain, you must create a full DID."]}),"\n",(0,i.jsx)(t.h3,{id:"write-did-to-chain",children:"Write DID to chain"}),"\n",(0,i.jsxs)(t.p,{children:["The KILT SDK provides multiple methods to create DIDs, this workshop highlights the ",(0,i.jsx)(t.code,{children:"createFromAccount"})," method, that creates a DID from any pre-existing substrate-compatible account."]}),"\n",(0,i.jsx)(t.admonition,{title:"Bring your own account",type:"info",children:(0,i.jsxs)(t.p,{children:["This workshop assumes you followed the ",(0,i.jsx)(t.a,{href:"/docs/develop/workshop/attester/account",children:"create account step"}),", but if you have a pre-existing account, you can use that instead."]})}),"\n",(0,i.jsx)(t.p,{children:"Create and submit the extrinsic (aka transaction) that registers the DID."}),"\n",(0,i.jsx)(o.c,{fileName:"attester/generateDid",children:r}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"publicKeyToChain"})," helper method returns a public key of the correct type."]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"txs"})," array holds the two transactions containing the extrinsics needed to submit to the chain for the Attester's DID creation."]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"createFromAccount"})," method takes the authenticated key of the account to attach the DID to, and the ",(0,i.jsx)(t.code,{children:"setAttestationKey"})," method takes the same parameter to set the attestation key the DID needs and uses."]}),"\n",(0,i.jsxs)(t.p,{children:["An Attester account needs to have an attestation key to write CTypes and attestations on chain. Use the ",(0,i.jsx)(t.code,{children:"setAttestationKey"})," method to set this. For this example transaction, the Attester account uses the ",(0,i.jsx)(t.code,{children:"dispatchAs"})," proxy method to assign the attestation key to the same account. However, you can also use this method to assign the attestation key to another account."]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"signAndSubmitTx"})," method then takes those transactions and submits them as a batch to the chain."]}),"\n",(0,i.jsx)(t.h2,{id:"run-the-code",children:"Run the code"}),"\n",(0,i.jsx)(t.p,{children:"Now run the code with:"}),"\n",(0,i.jsxs)(a.c,{groupId:"ts-js-choice",children:[(0,i.jsx)(c.c,{value:"ts",label:"Typescript",default:!0,children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"yarn ts-node ./attester/generateDid.ts\n"})})}),(0,i.jsx)(c.c,{value:"js",label:"Javascript",default:!0,children:(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"node ./attester/generateDid.js\n"})})})]}),"\n",(0,i.jsxs)(t.p,{children:["Once you have run the script, the output should provide you with the ",(0,i.jsx)(t.code,{children:"ATTESTER_DID_MNEMONIC"})," and ",(0,i.jsx)(t.code,{children:"ATTESTER_DID_URI"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"The output should look like the following, but not identical since the code creates the DIDs from your account:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:'ATTESTER_DID_MNEMONIC="beyond large galaxy\u2026\nATTESTER_DID_URI="did:kilt:4ohMvUHsyeD\u2026"\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Save the values in the ",(0,i.jsx)(t.code,{children:".env"})," file, which should now look like the following:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-env",metastring:'title=".env"',children:'WSS_ADDRESS=wss://peregrine.kilt.io\n\nATTESTER_ACCOUNT_MNEMONIC="warrior icon use cry...\nATTESTER_ACCOUNT_ADDRESS=4ohMvUHsyeDhMVZF...\nATTESTER_DID_MNEMONIC="beyond large galaxy...\nATTESTER_DID_URI="did:kilt:4ohMvUHsyeD..."\n'})}),"\n",(0,i.jsx)(t.p,{children:"Well done - You've generated a full DID! The next step is to create a CType!"})]})}function m(e={}){const{wrapper:t}={...(0,s.M)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(D,{...e})}):D(e)}},73484:(e,t,n)=>{"use strict";n.d(t,{c:()=>o});n(11504);var i=n(1608),s=n(17624);const o=e=>{let{children:t,funcName:n="main",leadingSpaces:o=2,dropHead:a=0,dropTail:c=0,...r}=e;const d=new RegExp(`${n}\\((?:.|\\n|\\r)*?\\)(?::(?:.|\\n|\\r)*?)?\\s*{(?:\\n|\\r)*(?<body>(?:.|\\n|\\r)+)\\}`),l=t.toString().match(d)??{};let h="";if(l?.groups?.body){const{body:e}=l.groups,t=e.split(/\r?\n/);h=t.map((e=>e.slice(o))).slice(parseInt(a),t.length-parseInt(c)-1).join("\n")}else h=t.toString();return(0,s.jsx)(i.c,{...r,children:h})}},96020:(e,t,n)=>{"use strict";n.d(t,{c:()=>p});var i=n(11504),s=n(28264),o=n(46352),a=n(58440),c=n(14300),r=n(28168),d=n(61268),l=n(87768),h=n(1608),u=n(17624);const p=e=>{let{children:t,fileName:n,...p}=e;const D=t,[m,f]=(0,i.useState)("# loading code..."),{siteConfig:{customFields:{prettierConfig:x}}}=(0,s.c)(),g=(0,i.useMemo)((()=>{const{code:e}=(0,o.transform)(D,{plugins:["transform-typescript"],retainLines:!0});return e}),[D]);(0,i.useEffect)((()=>{a.E9(g,{parser:"babel",plugins:[c.c,r.cp],...x}).then(f)}),[x,g]);const y=[{fileName:n?`${n}.ts`:void 0,fileContents:D,fileID:"ts",fileLabel:"Typescript"},{fileName:n?`${n}.js`:void 0,fileContents:m,fileID:"js",fileLabel:"Javascript"}];return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(d.c,{groupId:"ts-js-choice",children:y.map((e=>(0,u.jsx)(l.c,{value:e.fileID,label:e.fileLabel,default:!0,children:(0,u.jsx)(h.c,{...p,className:"language-"+e.fileID,title:e.fileName,children:e.fileContents})})))})})}}}]);