<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-develop/polarpath/switch_pallet" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Asset switch pallet | KILT Protocol</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.kilt.io/img/expert_dark_preview.png"><meta data-rh="true" name="twitter:image" content="https://docs.kilt.io/img/expert_dark_preview.png"><meta data-rh="true" property="og:url" content="https://docs.kilt.io/docs/develop/polarpath/switch_pallet"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Asset switch pallet | KILT Protocol"><meta data-rh="true" name="description" content="The asset switch pallet allows for switching the chain local currency 1:1 with a remote asset at a remote destination, according to the provided configuration, and using XCM."><meta data-rh="true" property="og:description" content="The asset switch pallet allows for switching the chain local currency 1:1 with a remote asset at a remote destination, according to the provided configuration, and using XCM."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.kilt.io/docs/develop/polarpath/switch_pallet"><link data-rh="true" rel="alternate" href="https://docs.kilt.io/docs/develop/polarpath/switch_pallet" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.kilt.io/docs/develop/polarpath/switch_pallet" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://I7C7DMFMTM-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="KILT Protocol" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5f283d2b.css">
<script src="/assets/js/runtime~main.aa699296.js" defer="defer"></script>
<script src="/assets/js/main.adea6719.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#2db528;color:#fff" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">DIP enables OpenID inspired cross-chain identity, <a href="/docs/concepts/dip/what-is-dip">help us test this new feature</a>!</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_light.svg" alt="KILT Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.svg" alt="KILT Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/docs/concepts/what-is-kilt">What is KILT?</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/docs/develop/polarpath/switch_pallet">Develop</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/develop/sdk/quickstart">SDK Documentation</a></li><li><a class="dropdown__link" href="/docs/develop/chain/introduction">Blockchain Documentation</a></li><li><a class="dropdown__link" href="/docs/develop/workshop/welcome">Workshop</a></li><li><a class="dropdown__link" href="/docs/develop/contribute">Contribute</a></li><li><a class="dropdown__link" href="/docs/develop/specifications">Technical Specifications</a></li><li><a class="dropdown__link" href="/docs/develop/builtonkilt">Built on KILT</a></li><li><a class="dropdown__link" href="/docs/develop/dApp/welcome">DApp Documentation</a></li><li><a class="dropdown__link" href="/docs/develop/opendid/what-is-opendid">OpenDID Documentation</a></li><li><a class="dropdown__link" href="/docs/develop/polarpath/what-is-polarpath">Polar path Documentation</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/docs/develop/polarpath/switch_pallet">Participate</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/participate/staking/become_a_collator/overview">Staking</a></li><li><a class="dropdown__link" href="/docs/participate/governance/vote">Voting</a></li><li><a class="dropdown__link" href="/docs/participate/treasury-proposal">Treasury Proposals</a></li><li><a class="dropdown__link" href="/docs/participate/content-creation-guidelines">Content Creation Guidelines</a></li><li><a class="dropdown__link" href="/docs/participate/treasury-tip">Treasury Tips</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/KILTprotocol/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Asset switch pallet</h1>
<p>The asset switch pallet allows for switching the chain local currency 1:1 with a remote asset at a remote destination, according to the provided configuration, and using XCM.</p>
<p>This is possible by creating a <em>switch pair</em>, which contains information about the remote asset&#x27;s identifier (e.g., its <code>Location</code>), the remote location where the asset lives (and with which XCM communication takes place), the circulating supply of the remote asset, which can be switched back for the local currency, and additional information relevant for the XCM communication, which is explained more in-depth later on.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" href="/docs/develop/polarpath/switch_pallet#summary">​</a></h2>
<p>The pallet lets users on the local chain lock <code>N</code> tokens of the chain&#x27;s native currency into a switch pair-specific account to receive <code>N</code> remote assets on the configured remote location, which are transferred to them from the source chain&#x27;s sovereign account on the remote chain.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="design-choices">Design choices<a class="hash-link" aria-label="Direct link to Design choices" title="Direct link to Design choices" href="/docs/develop/polarpath/switch_pallet#design-choices">​</a></h2>
<p>The pallet aims to be generic enough for most parachains to be able to add one or more instances of the asset switch pallet into their runtime, after configuring it according to their needs.</p>
<p>The pallet makes the following assumptions:</p>
<ul>
<li>The local asset to switch is always the chain local currency, implementing the <code>fungible::Mutate</code> trait.</li>
<li>The switch ratio is pre-defined to be 1:1, i.e., one unit of local currency for one unit of remote asset.</li>
<li>The pallet only exposes calls to allow local -&gt; remote switches. The reverse is assumed to happen via XCM reserve transfer from the configured remote location, for which the pallet crate provides all the XCM components that are dynamically configured based on the switch pair information stored within each instance of this pallet.</li>
<li>The sovereign account of the source chain at destination owns the remote assets in the amount that is specified when the switch pair is created. The validation of this requirement is delegated to the source chain governance in the act leading to the creation of the switch pair, as the source chain itself has currently no means of doing that.</li>
<li>To account for failure on the remote destination, the pallet stores unconfirmed operations in a storage map. The remote chain then sends <code>Report</code> messages back to either confirm or revert a transfer. In the meanwhile, the source chain (where this pallet is deployed) assumes the transfer will be successful and updates all related counters tracking the destination state, to then revert them in case of failures.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-the-pallet-to-the-runtime">Add the pallet to the runtime<a class="hash-link" aria-label="Direct link to Add the pallet to the runtime" title="Direct link to Add the pallet to the runtime" href="/docs/develop/polarpath/switch_pallet#add-the-pallet-to-the-runtime">​</a></h2>
<p>Add the following line to the runtime <code>Cargo.toml</code> dependencies section:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pallet-asset-switch = {git = &quot;https://github.com/KILTprotocol/kilt-node.git&quot;, branch = &quot;release-1.14.0&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The asset switch pallet is available in the KILT node release 1.14.0 and later.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-the-pallet">Configure the pallet<a class="hash-link" aria-label="Direct link to Configure the pallet" title="Direct link to Configure the pallet" href="/docs/develop/polarpath/switch_pallet#configure-the-pallet">​</a></h2>
<p>The pallet can be added one or more times to the runtime.</p>
<p>For multiple deployments of the same pallet (e.g., to bridge the local currency to different remote assets), pass runtime configuration to the pallet&#x27;s <code>Config</code> trait.</p>
<div class="language-rust,ignore codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust,ignore codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub type SwitchPool1 = pallet_asset_switch::Instance1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl pallet_asset_switch::Config&lt;SwitchPool1&gt; for Runtime {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	// Config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub type SwitchPool2 = pallet_asset_switch::Instance2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl pallet_asset_switch::Config&lt;SwitchPool2&gt; for Runtime {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	// Config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If a single instance is required, then use the default instance:</p>
<div class="language-rust,ignore codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust,ignore codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl pallet_asset_switch::Config for Runtime {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-config-trait">The <code>Config</code> trait<a class="hash-link" aria-label="Direct link to the-config-trait" title="Direct link to the-config-trait" href="/docs/develop/polarpath/switch_pallet#the-config-trait">​</a></h2>
<p>As the pallet is generic over the runtime specifics, the <code>Config</code> trait requires the following configuration parameters passed to it:</p>
<ul>
<li><code>type AccountIdConverter: TryConvert&lt;Self::AccountId, Junction&gt;</code>: Because the <code>AccountId</code> type can be anything in the runtime, the converter is responsible for converting such a <code>AccountId</code> into a <code>Junction</code>, which is then used for some XCM processing.</li>
<li><code>type AssetTransactor: TransactAsset</code>: This component is used when charging the extrinsic submitter with the XCM fees that the chain will pay at the remote chain. For instance, if the transfer on the remote chain will cost 0.1 DOTs, the <code>AssetTransactor</code> might deduct 0.1 DOTs from the user&#x27;s previously topped up balance on the source chain (more details below).</li>
<li><code>type FeeOrigin: EnsureOrigin&lt;Self::RuntimeOrigin&gt;</code>: The origin that can update the XCM fee to be paid for the transfer on the remote chain.</li>
<li><code>type LocalCurrency: MutateFungible&lt;Self::AccountId&gt;</code>: The chain&#x27;s local currency.</li>
<li><code>type PauseOrigin: EnsureOrigin&lt;Self::RuntimeOrigin&gt;</code>: The origin that can pause a switch pair, e.g., if a vulnerability is found.</li>
<li><code>type RuntimeEvent: From&lt;Event&lt;Self, I&gt;&gt; + IsType&lt;&lt;Self as frame_system::Config&gt;::RuntimeEvent&gt;</code>: The aggregate <code>Event</code> type.</li>
<li><code>type SubmitterOrigin: EnsureOrigin&lt;Self::RuntimeOrigin, Success = Self::AccountId&gt;</code>: The origin that can call the <code>switch</code> extrinsic and perform the switch.</li>
<li><code>type SwitchHooks: SwitchHooks&lt;Self, I&gt;</code>: Any additional runtime-specific logic that can be injected both before and after local tokens are exchanged for the remote assets, and before and after the remote assets are converted into local tokens.</li>
<li><code>type SwitchOrigin: EnsureOrigin&lt;Self::RuntimeOrigin&gt;</code>: The origin that can set, resume, and delete a switch pair.</li>
<li><code>type UniversalLocation: Get&lt;InteriorLocation&gt;</code>: The location of the parachain relative to the global consensus space.</li>
<li><code>type WeightInfo: WeightInfo</code>: The computed weights of the pallet after benchmarking it.</li>
<li><code>type XcmRouter: SendXcm</code>: The component responsible for routing XCM messages to the switch pair remote location to perform the remote asset transfer from the chain&#x27;s sovereign account to the specified beneficiary.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmark-only-config-components">Benchmark-only <code>Config</code> components<a class="hash-link" aria-label="Direct link to benchmark-only-config-components" title="Direct link to benchmark-only-config-components" href="/docs/develop/polarpath/switch_pallet#benchmark-only-config-components">​</a></h3>
<ul>
<li><code>type BenchmarkHelper: BenchmarkHelper</code>: Helper trait to allow the runtime to set the ground before the benchmark logic is executed. It allows the runtime to return any of the parameters that are used in the extrinsic benchmarks, or <code>None</code> if the runtime has no special conditions to fulfil.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="storage">Storage<a class="hash-link" aria-label="Direct link to Storage" title="Direct link to Storage" href="/docs/develop/polarpath/switch_pallet#storage">​</a></h2>
<p>The pallet has a single <code>SwitchPair</code> storage value that contains a <code>Option&lt;SwitchPairInfo&gt;</code>.
If unset, no switch pair is configured hence no switch can happen.
When set and its status is <code>Running</code>, switches are enabled in both directions.</p>
<p>Two more storage components, <code>PendingSwitchConfirmations</code> and <code>NextQueryId</code>, are used for error recovery.
Specifically, the former stores information about transfers executed locally but that have not been confirmed on the remote destination.
Once a transfer either succeeds or fails, the entry is removed from the storage and additional actions are taken as needed, e.g., reverting the transfer locally as well.Th
The latter stores an ever-increasing counter, which wraps around itself when it would overflow, and provides the value the <code>PendingSwitchConfirmations</code> storage map uses to keep track of pending confirmations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="events">Events<a class="hash-link" aria-label="Direct link to Events" title="Direct link to Events" href="/docs/develop/polarpath/switch_pallet#events">​</a></h2>
<p>The pallet generates the following events:</p>
<ul>
<li><code>SwitchPairCreated</code>: when a new switch pair is created by the required origin, e.g., governance.</li>
<li><code>SwitchPairRemoved</code>: when a switch pair is removed by the root origin.</li>
<li><code>SwitchPairResumed</code>: when a switch pair has (re-)enabled local to remote asset switches.</li>
<li><code>SwitchPairPaused</code>: when a switch pair has been paused.</li>
<li><code>SwitchPairFeeUpdated</code>: when the XCM fee for the switch transfer has been updated.</li>
<li><code>LocalToRemoteSwitchExecuted</code>: when a switch of some local tokens for the remote asset has taken place.</li>
<li><code>RemoteToLocalSwitchExecuted</code>: when a switch of some remote assets for the local tokens has taken place.</li>
<li><code>LocalToRemoteSwitchReverted</code>: when a switch fails on the remote destination and is reverted on the source chain as well.</li>
<li><code>LocalToRemoteSwitchFinalized</code>: when a switch is confirmed to have successfully taken place at the remote destination.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="calls">Calls<a class="hash-link" aria-label="Direct link to Calls" title="Direct link to Calls" href="/docs/develop/polarpath/switch_pallet#calls">​</a></h2>
<ol>
<li>
<p><code>pub fn set_switch_pair(origin: OriginFor&lt;T&gt;, remote_asset_total_supply: u128, remote_asset_id: Box&lt;VersionedAssetId&gt;, remote_asset_circulating_supply: u128, remote_reserve_location: Box&lt;Location&gt;, remote_asset_ed: u128, remote_xcm_fee: Box&lt;Asset&gt;) -&gt; DispatchResult</code>: Set a new switch pair between the local currency and the specified <code>remote_asset_id</code> on the <code>reserve_location</code>. The specified <code>total_issuance</code> includes both the <code>circulating_supply</code> (i.e., the remote asset amount that the chain does not control on the <code>reserve_location</code>) and the locked supply under the control of the chain&#x27;s sovereign account on the <code>reserve_location</code>. For this reason, the value of <code>total_issuance</code> must be at least as large as <code>circulating_supply</code>. It is possible for <code>circulating_supply</code> to be <code>0</code>, in which case it means this chain controls all the <code>total_issuance</code> of the remote asset, which can be obtained by locking a corresponding amount of local tokens via the <code>switch</code> call below.</p>
<p>Furthermore, the pallet calculates the account that will hold the local tokens locked in exchange for remote tokens. This account is based on the pallet runtime name as returned by the <code>PalletInfoAccess</code> trait and the value of <code>remote_asset_id</code>. The generated account must already have a balance of at least <code>circulating_supply</code>, ensuring enough local tokens are locked to satisfy all requests to exchange the remote asset for local tokens. The balance of such an account can be increased with a simple transfer after obtaining the to-be-created switch pair pool account by interacting with the <a href="https://github.com/KILTprotocol/kilt-node/tree/master/runtime-api/asset-switch" target="_blank" rel="noopener noreferrer">asset-switch runtime API</a>.</p>
<p>This requirement can be bypassed with the <code>force_set_switch_pair</code> call. Only <code>SwitchOrigin</code> can call this, and in most cases it will most likely be a governance-based origin such as the one provided by referenda or collectives with high privileges.</p>
</li>
<li>
<p><code>pub fn force_set_switch_pair(origin: OriginFor&lt;T&gt;, remote_asset_total_supply: u128, remote_asset_id: Box&lt;VersionedAssetId&gt;, remote_asset_circulating_supply: u128, remote_reserve_location: Box&lt;Location&gt;, remote_asset_ed: u128, remote_xcm_fee: Box&lt;Asset&gt;) -&gt; DispatchResult</code>: The same as the <code>set_switch_pair</code>, but skips the check over the switch pair pool account balance, and requires the <code>root</code> origin for the call to be dispatched.</p>
</li>
<li>
<p><code>pub fn force_unset_switch_pair(origin: OriginFor&lt;T&gt;) -&gt; DispatchResult</code>: Forcibly remove a previously-stored switch pair. This operation can only be called by the <code>root</code> origin.</p>
<p><strong>Any intermediate state, such as local tokens locked in the switch pair pool or remote assets that are not switchable anymore for local tokens, must be taken care of with subsequent governance operations.</strong></p>
</li>
<li>
<p><code>pub fn pause_switch_pair(origin: OriginFor&lt;T&gt;) -&gt; DispatchResult</code>: Allows the <code>PauseOrigin</code> to immediately pause switches in both directions.</p>
</li>
<li>
<p><code>pub fn resume_switch_pair(origin: OriginFor&lt;T&gt;) -&gt; DispatchResult</code>: Allows the <code>SwitchOrigin</code> to resume switches in both directions.</p>
</li>
<li>
<p><code>pub fn remote_xcm_fee(origin: OriginFor&lt;T&gt;, new: Box&lt;Asset&gt;) -&gt; DispatchResult</code>: Allows the <code>FeeOrigin</code> to update the required XCM fee to execute the transfer of remote asset on the reserve location from the chain&#x27;s sovereign account to the beneficiary specified in the <code>switch</code> operation.</p>
<p>For example, if the cost of sending an XCM message containing a <code>TransferAsset</code> instruction from the source chain to AssetHub (reserve location) changes from 0.1 DOTs to 0.2 DOTs, the fee will need to be updated accordingly to avoid transfers failing on AssetHub, leaving the whole system in an inconsistent state. Since the pallet refunds any unused assets on the reserve location to the account initiating the switch on the source chain, it is not a big issue to overestimate this value here since no funds will be burnt or unfairly taken from the user during the switch process.</p>
</li>
<li>
<p><code>pub fn switch(origin: OriginFor&lt;T&gt;, local_asset_amount: LocalCurrencyBalanceOf&lt;T, I&gt;, beneficiary: Box&lt;Location&gt;) -&gt; DispatchResult</code>: Allows the <code>SubmitterOrigin</code> to perform a switch of some local tokens for the corresponding amount of remote assets on the configured <code>reserve_location</code>. The switch will fail on the source chain if any of the following preconditions are not met:</p>
<ol>
<li>The submitter does not have enough balance to pay for the tx fees on the source chain or to cover the amount of local tokens requested. Hence, the user&#x27;s local balance must be greater than or equal to the amount of tokens requested in the switch + the cost of executing the extrinsic on the source chain.</li>
<li>No switch pair is set or the switch pair is currently not allowing switches.</li>
<li>There are not enough locked remote assets on the <code>reserve_location</code> to cover the switch request. e.g., if the chain sovereign account on the <code>reserve_location</code> only controls <code>10</code> remote assets, users can only switch up to <code>10</code> local tokens. Once the limit is reached, someone needs to perform the reverse operation (remote -&gt; local switch) to free up some remote tokens.</li>
<li>The switch pair <code>reserve_location</code> is not reachable from the source chain, because the configured <code>XcmRouter</code> returns an error (e.g., there is no XCM channel between the two chains).</li>
<li>The configured <code>SwitchHooks</code> returns an error in either the <code>pre-</code> or the <code>post-</code> switch checks.</li>
<li>The user does not have enough assets to pay for the required remote XCM fees as specified in the switch pair info and as returned by the configured <code>AssetTransactor</code>.</li>
</ol>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="xcm-components">XCM components<a class="hash-link" aria-label="Direct link to XCM components" title="Direct link to XCM components" href="/docs/develop/polarpath/switch_pallet#xcm-components">​</a></h2>
<p>Because the switch functionality relies on XCM, the pallet provides a few XCM components that should be included in a runtime to enable the whole set of interactions between the source chain and the configured remote reserve location.</p>
<ul>
<li><code>AccountId32ToAccountId32JunctionConverter</code> in <a href="https://raw.githubusercontent.com/KILTprotocol/kilt-node/master/pallets/pallet-asset-switch/src/xcm/convert/mod.rs" target="_blank" rel="noopener noreferrer">xcm::convert</a>: provides an implementation for the pallet&#x27;s <code>AccountIdConverter</code> config component, that converts local <code>AccountId32</code>s into a <code>AccountId32</code> XCM <code>Junction</code>. This works only for chains that use <code>AccountId32</code> as their overarching <code>AccountId</code> type.</li>
<li><code>MatchesSwitchPairXcmFeeFungibleAsset</code> in <a href="https://raw.githubusercontent.com/KILTprotocol/kilt-node/master/pallets/pallet-asset-switch/src/xcm/match/mod.rs" target="_blank" rel="noopener noreferrer">xcm::match</a>: provides an implementation of the <code>MatchesFungibles&lt;Location, Fungibles::Balance&gt;</code> that returns the input <code>Asset</code> if its ID matches the XCM fee asset ID as configured in the switch pair, if present. If no switch pair is present or if the ID does not match, it returns a <a href="https://github.com/paritytech/polkadot-sdk/blob/33324fe01c5b1f341687cef2aa6e767f6acf40f3/polkadot/xcm/xcm-executor/src/traits/token_matching.rs#L54" target="_blank" rel="noopener noreferrer">XcmExecutorError::AssetNotHandled</a>, which does not prevent other matchers after it to apply their matching logic. It can be used for the <code>AssetTransactor</code> property of the <a href="https://github.com/paritytech/polkadot-sdk/blob/33324fe01c5b1f341687cef2aa6e767f6acf40f3/polkadot/xcm/xcm-executor/src/config.rs#L31" target="_blank" rel="noopener noreferrer">XcmExecutor::Config</a> and as the <code>AssetTransactor</code> component of this pallet in the runtime.</li>
<li><code>UsingComponentsForXcmFeeAsset</code> in <a href="https://raw.githubusercontent.com/KILTprotocol/kilt-node/master/pallets/pallet-asset-switch/src/xcm/trade/mod.rs" target="_blank" rel="noopener noreferrer">xcm::trade</a>: provides an implementation of <code>WeightTrader</code> that allows buying weight using the XCM fee asset configured in the switch pair. That is, if the XCM fee asset is DOT, and users need to send DOTs to this chain in order to pay for XCM fees, this component lets them use those very same DOTs that are being sent to pay for the XCM fees on this chain. Any unused weight is burnt, since this chain&#x27;s sovereign account already controls the whole amount on the reserve location due to the nature of reserve-based transfers. It can be used for the <code>Trader</code> property of the <a href="https://github.com/paritytech/polkadot-sdk/blob/33324fe01c5b1f341687cef2aa6e767f6acf40f3/polkadot/xcm/xcm-executor/src/config.rs#L31" target="_blank" rel="noopener noreferrer">XcmExecutor::Config</a>.</li>
<li><code>UsingComponentsForSwitchPairRemoteAsset</code> in <a href="https://raw.githubusercontent.com/KILTprotocol/kilt-node/master/pallets/pallet-asset-switch/src/xcm/trade/mod.rs" target="_blank" rel="noopener noreferrer">xcm::trade</a>: provides an implementation of <code>WeightTrader</code> that allows buying weight using the remote asset configured in the switch pair when sending it to this chain to be switched for local tokens. Any unused weight is transferred from the switch pair account to the configured <code>FeeDestinationAccount</code>, as those local tokens do not need to back any remote assets because they have been used to pay for XCM fees. It can be used for the <code>Trader</code> property of the <a href="https://github.com/paritytech/polkadot-sdk/blob/33324fe01c5b1f341687cef2aa6e767f6acf40f3/polkadot/xcm/xcm-executor/src/config.rs#L31" target="_blank" rel="noopener noreferrer">XcmExecutor::Config</a>.</li>
<li><code>SwitchPairRemoteAssetTransactor</code> in <a href="https://raw.githubusercontent.com/KILTprotocol/kilt-node/master/pallets/pallet-asset-switch/src/xcm/transact/mod.rs" target="_blank" rel="noopener noreferrer">xcm::transact</a>: provides an implementation of <code>TransactAsset::deposit_asset</code> that matches the asset to be deposited with the remote asset configured in the switch pair &#x27;(else it returns <a href="https://github.com/paritytech/polkadot-sdk/blob/e5791a56dcc35e308a80985cc3b6b7f2ed1eb6ec/polkadot/xcm/src/v3/traits.rs#L68" target="_blank" rel="noopener noreferrer">Error::AssetNotFound</a>) and moves as many local tokens from the switch pair account to the specified <code>who</code> destination. It also calls into the <code>SwitchHooks</code> pre- and post- checks, and generates a <code>RemoteToLocalSwitchExecuted</code> if everything is completed successfully. It can be used for the <code>AssetTransactor</code> property of the <a href="https://github.com/paritytech/polkadot-sdk/blob/33324fe01c5b1f341687cef2aa6e767f6acf40f3/polkadot/xcm/xcm-executor/src/config.rs#L31" target="_blank" rel="noopener noreferrer">XcmExecutor::Config</a>.</li>
<li><code>IsSwitchPairXcmFeeAsset</code> in <a href="https://raw.githubusercontent.com/KILTprotocol/kilt-node/master/pallets/pallet-asset-switch/src/xcm/transfer/mod.rs" target="_blank" rel="noopener noreferrer">xcm::transfer</a>: provides an implementation of <code>ContainsPair&lt;Asset, Location&gt;</code> that returns <code>true</code> if the given asset and sender match the stored switch pair XCM fee asset and reserve location respectively. It can be used for the <code>IsReserve</code> property of the <a href="https://github.com/paritytech/polkadot-sdk/blob/33324fe01c5b1f341687cef2aa6e767f6acf40f3/polkadot/xcm/xcm-executor/src/config.rs#L31" target="_blank" rel="noopener noreferrer">XcmExecutor::Config</a>.</li>
<li><code>IsSwitchPairRemoteAsset</code> in <a href="https://raw.githubusercontent.com/KILTprotocol/kilt-node/master/pallets/pallet-asset-switch/src/xcm/transfer/mod.rs" target="_blank" rel="noopener noreferrer">xcm::transfer</a>: provides an implementation of <code>ContainsPair&lt;Asset, Location&gt;</code> that returns <code>true</code> if the given asset and sender match the stored switch pair remote asset and reserve location respectively. It can be used for the <code>IsReserve</code> property of the <a href="https://github.com/paritytech/polkadot-sdk/blob/33324fe01c5b1f341687cef2aa6e767f6acf40f3/polkadot/xcm/xcm-executor/src/config.rs#L31" target="_blank" rel="noopener noreferrer">XcmExecutor::Config</a>.</li>
</ul>
<p>The pallet itself implements the <a href="https://github.com/paritytech/polkadot-sdk/blob/33324fe01c5b1f341687cef2aa6e767f6acf40f3/polkadot/xcm/xcm-executor/src/traits/on_response.rs#L29" target="_blank" rel="noopener noreferrer">OnResponse trait</a>, that must be added to runtimes that deploy this pallet to allow for the error-recovery process to take place.
The trait implementation validates the received query response message based on the state of the switch pair, and then performs the required action on the pending transfer info accordingly.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/KILTprotocol/docs/edit/master/docs/develop/09_polarpath/02_switch_pallet.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-12-06T14:40:53.000Z" itemprop="dateModified">Dec 6, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docs/develop/polarpath/switch_pallet#summary">Summary</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/develop/polarpath/switch_pallet#design-choices">Design choices</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/develop/polarpath/switch_pallet#add-the-pallet-to-the-runtime">Add the pallet to the runtime</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/develop/polarpath/switch_pallet#configure-the-pallet">Configure the pallet</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/develop/polarpath/switch_pallet#the-config-trait">The <code>Config</code> trait</a><ul><li><a class="table-of-contents__link toc-highlight" href="/docs/develop/polarpath/switch_pallet#benchmark-only-config-components">Benchmark-only <code>Config</code> components</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/docs/develop/polarpath/switch_pallet#storage">Storage</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/develop/polarpath/switch_pallet#events">Events</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/develop/polarpath/switch_pallet#calls">Calls</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/develop/polarpath/switch_pallet#xcm-components">XCM components</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/hX4pc8rdHS" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/Kiltprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.kilt.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">KILT Protocol<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kilt-protocol.medium.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/KILTprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.kilt.io/imprint/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Imprint<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.kilt.io/disclaimer/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Disclaimer<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.kilt.io/privacy-policy-for-kilt-protocol/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 BOTLabs GmbH – All rights reserved. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>