(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1036],{5380:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=5380,e.exports=t},6793:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});var i=r(7294),n=r(6823);const s=e=>{let{children:t,funcName:r="main",funcEnd:s="}",snippets:a,leadingSpaces:l=2,...o}=e;const c=t.split(/\r?\n/);let d="";if(a)d=JSON.parse(a).map((e=>Array.isArray(e)?c.slice(e[0],e[1]).map((e=>e.slice(l))).join("\n"):e)).join("\n");else if(r){let e,t;for(let i=0;i<c.length;i++)if(c[i].includes(r)){if(e=i,c[i].includes(" {"))break}else if(c[i].includes(" {")&&void 0!==e){e=i;break}for(let r=c.length-1;r>0;r--)if(c[r].includes(s)){t=r;break}d=c.slice(e+1,t).map((e=>e.slice(l))).join("\n")}return i.createElement(n.Z,o,d)}},1909:(e,t,r)=>{"use strict";r.d(t,{Z:()=>f});var i=r(7462),n=r(7294),s=r(2263),a=r(3945),l=r(8182),o=r(2175),c=r(5488),d=r(5162),p=r(6823);const f=e=>{let{children:t,fileName:r,...f}=e;const u=t,{code:m}=(0,o.transform)(u,{plugins:["transform-typescript"],retainLines:!0}),{siteConfig:{customFields:{prettierConfig:y}}}=(0,s.Z)(),v=(0,a.format)(m,{parser:l.parsers.babel.parse,...y}),g=r?`${r}.ts`:void 0,h=r?`${r}.js`:void 0;return n.createElement(c.Z,{groupId:"ts-js-choice"},n.createElement(d.Z,{value:"ts",label:"Typescript",default:!0},n.createElement(p.Z,(0,i.Z)({},f,{className:"language-ts",title:g}),u)),n.createElement(d.Z,{value:"js",label:"Javascript"},n.createElement(p.Z,(0,i.Z)({},f,{className:"language-js",title:h}),v)))}},9747:(e,t,r)=>{"use strict";r.d(t,{Z:()=>f});var i=r(7462),n=r(7294),s=r(2263),a=r(3945),l=r(8182),o=r(2175),c=r(5488),d=r(5162),p=r(6793);const f=e=>{let{children:t,fileName:r,...f}=e;const u=t,{code:m}=(0,o.transform)(u,{plugins:["transform-typescript"],retainLines:!0}),{siteConfig:{customFields:{prettierConfig:y}}}=(0,s.Z)(),v=(0,a.format)(m,{parser:l.parsers.babel.parse,...y}),g=r?`${r}.ts`:void 0,h=r?`${r}.js`:void 0;return n.createElement(c.Z,{groupId:"ts-js-choice"},n.createElement(d.Z,{value:"ts",label:"Typescript",default:!0},n.createElement(p.Z,(0,i.Z)({},f,{className:"language-ts",title:g}),u)),n.createElement(d.Z,{value:"js",label:"Javascript"},n.createElement(p.Z,(0,i.Z)({},f,{className:"language-js",title:h}),v)))}},8953:(e,t,r)=>{"use strict";r.r(t),r.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>c,toc:()=>p});var i=r(7462),n=(r(7294),r(3905)),s=r(9747),a=r(1909);const l={id:"verify",title:"Verifier Verifies a Credential"},o=void 0,c={unversionedId:"develop/dApp/verifier/verify",id:"develop/dApp/verifier/verify",title:"Verifier Verifies a Credential",description:"After sending the request-credential message to the extension, the verifier listens for a message of type submit-credential in response.",source:"@site/docs/develop/07_dApp/04_verifier/03_verifyCrendentials.md",sourceDirName:"develop/07_dApp/04_verifier",slug:"/develop/dApp/verifier/verify",permalink:"/docs/develop/dApp/verifier/verify",draft:!1,editUrl:"https://github.com/KILTprotocol/docs/edit/master/docs/develop/07_dApp/04_verifier/03_verifyCrendentials.md",tags:[],version:"current",lastUpdatedAt:1673884454,formattedLastUpdatedAt:"Jan 16, 2023",sidebarPosition:3,frontMatter:{id:"verify",title:"Verifier Verifies a Credential"},sidebar:"dApp",previous:{title:"Verifier Requests a Credential",permalink:"/docs/develop/dApp/verifier/request"}},d={},p=[],f={toc:p};function u(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,i.Z)({},f,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"After sending the ",(0,n.kt)("inlineCode",{parentName:"p"},"request-credential")," message to the extension, the verifier listens for a message of type ",(0,n.kt)("inlineCode",{parentName:"p"},"submit-credential")," in response."),(0,n.kt)("p",null,"When a message is received, decrypt it and check that it has the expected type:"),(0,n.kt)(s.Z,{mdxType:"TsJsSnippet"},"import * as Kilt from '@kiltprotocol/sdk-js'\n\nimport { verify } from './verifyCredential'\n\ntype ListenCallback = (message: Kilt.IEncryptedMessage) => Promise<void>\n\nlet session: { listen: (call: ListenCallback) => ReturnType<ListenCallback> }\nlet receiverSecretKey: Kilt.Utils.Crypto.CryptoInput\n\nexport async function main() {\n  await session.listen(async (message: Kilt.IEncryptedMessage) => {\n    // Create a callback that uses the DID encryption key to decrypt the message.\n    const decryptCallback: Kilt.DecryptCallback = async ({\n      data,\n      nonce,\n      peerPublicKey\n    }) => {\n      const result = Kilt.Utils.Crypto.decryptAsymmetric(\n        { box: data, nonce },\n        peerPublicKey,\n        receiverSecretKey\n      )\n      if (!result) {\n        throw new Error('Cannot decrypt')\n      }\n      return {\n        data: result\n      }\n    }\n\n    const decryptedMessage = await Kilt.Message.decrypt(\n      message,\n      decryptCallback\n    )\n\n    if (decryptedMessage.body.type !== 'submit-credential') {\n      throw new Error('Unexpected message type')\n    }\n\n    await verify(decryptedMessage.body.content)\n  })\n}\n"),(0,n.kt)("p",null,"Finally the message content (the credential that was requested) can be verified using the request challenge that was previously stored on the server side.\nThis function will throw if the verification is not successful."),(0,n.kt)(a.Z,{mdxType:"TsJsBlock"},"import * as Kilt from '@kiltprotocol/sdk-js'\n\nexport async function verify(credentials: Kilt.ICredentialPresentation[]) {\n  return Kilt.Credential.verifyPresentation(credentials[0])\n}\n"),(0,n.kt)("p",null,"That's it! Your verifier has successfully requested and verified a credential."))}u.isMDXComponent=!0}}]);