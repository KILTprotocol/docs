"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6347],{2695:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var i=t(4848),d=t(8453);const o={id:"flow",title:"OpenDID Flow"},s=void 0,r={id:"develop/opendid/flow",title:"OpenDID Flow",description:"This guide explains the internal workings of OpenDID.",source:"@site/docs/develop/08_opendid/02_opendid_flow.md",sourceDirName:"develop/08_opendid",slug:"/develop/opendid/flow",permalink:"/docs/develop/opendid/flow",draft:!1,unlisted:!1,editUrl:"https://github.com/KILTprotocol/docs/edit/master/docs/develop/08_opendid/02_opendid_flow.md",tags:[],version:"current",lastUpdatedAt:172198217e4,sidebarPosition:2,frontMatter:{id:"flow",title:"OpenDID Flow"},sidebar:"opendid",previous:{title:"Overview",permalink:"/docs/develop/opendid/what-is-opendid"},next:{title:"Run OpenDID Service",permalink:"/docs/develop/opendid/opendid_service"}},l={},c=[];function a(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",li:"li",mermaid:"mermaid",ol:"ol",p:"p",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This guide explains the internal workings of OpenDID.\nUnderstanding this flow is helpful for setting up and configuring an OpenDID Service but less important if you only need to integrate it in an application."}),"\n",(0,i.jsx)(n.p,{children:"OpenDID includes interactions between multiple apps to authenticate and authorize users.\nCommon use cases include the following:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Web app front end (app that includes the login button, for example, the demo app)"}),"\n",(0,i.jsx)(n.li,{children:"Web app back end"}),"\n",(0,i.jsx)(n.li,{children:"OpenDID front end"}),"\n",(0,i.jsx)(n.li,{children:"OpenDID back end"}),"\n",(0,i.jsxs)(n.li,{children:["Identity wallet that follows ",(0,i.jsx)(n.a,{href:"https://github.com/KILTprotocol/spec-ext-credential-api",children:"the Credential API spec"})," (typically a browser extension, for example, ",(0,i.jsx)(n.a,{href:"https://www.sporran.org/",children:"Sporran"}),")"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The following steps outline the interactions necessary to implement ",(0,i.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#ImplicitFlowAuth",children:"the implicit flow"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["The user clicks the login button on the ",(0,i.jsx)(n.em,{children:"web app front end"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.em,{children:"web app front end"})," redirects the user to the ",(0,i.jsx)(n.em,{children:"OpenDID front end"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"The user chooses what wallet to authenticate with."}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.em,{children:"OpenDID back end"})," establishes a secure session with the ",(0,i.jsx)(n.em,{children:"identity wallet"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.em,{children:"OpenDID back end"})," optionally requests a credential that implements a specific CType."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.em,{children:"identity wallet"})," provides the ",(0,i.jsx)(n.em,{children:"OpenDID back end"})," with the requested credential, after authenticating the DID holder."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.em,{children:"OpenDID back end"})," returns a ",(0,i.jsx)(n.code,{children:"id_token"})," as a JSON web token (JWT) to the ",(0,i.jsx)(n.em,{children:"OpenDID front end"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:"OpenDID front end"})," redirects the user back to a specific ",(0,i.jsx)(n.code,{children:"redirect_url"})," on the ",(0,i.jsx)(n.em,{children:"web app front end"})," including the ",(0,i.jsx)(n.code,{children:"id_token"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.em,{children:"web app front end"})," detects the ",(0,i.jsx)(n.code,{children:"id_token"})," and sends it to the ",(0,i.jsx)(n.em,{children:"web app back end"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.em,{children:"web app back end"})," verifies the ",(0,i.jsx)(n.code,{children:"id_token"})," and ensures the validity of the credential."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The following sequence diagram summarizes the flow:"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n\nparticipant AB as WebApp Backend\nparticipant AF as WebApp Frontend\nparticipant OF as OpenDID Frontend\nparticipant OB as OpenDID Backend\nparticipant IW as Identity Wallet\n\nAF->>OF: (1, 2) Authorize (redirect_uri: /callback)\nOF->>OF: (3) Pick Identity Wallet\ncritical (4) Key Exchange\nOF->>OB: GET Challenge\nOB--\x3e>OF: Challenge\nOF->>IW: Start Session\nIW--\x3e>OF: Encrypted Challenge\nOF->>OB: POST Challenge\nOB--\x3e>OF: OK\nend\n\ncritical Authenticate\nOF->>OB: (5) GET Credential Requirements\nOB--\x3e>OF: Credential Requirements\nOF->>IW: (6) Request Credential\nIW->>IW: Authenticate User\nIW->>OF: Credential\nOF->>OB: POST Credential\nOB->>OB: Verify Credential\nOB->>OF: (7) `id_token`)\nend\n\nOF->>AF: redirect to /callback with `id_token`\nAF->>AB: (8) `id_token`\nAB->>AB: (9) verify `id_token`\nAB->>AF: (10) Access granted.\n"}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Although this example describes the implicit flow, ",(0,i.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#CodeFlowAuth",children:"the authorization code flow"})," is similar.\nInstead of returning an ",(0,i.jsx)(n.code,{children:"id_token"})," directly, the OpenDID service instead returns a ",(0,i.jsx)(n.code,{children:"code"})," to exchange for an ",(0,i.jsx)(n.code,{children:"id_token"})," using the ",(0,i.jsx)(n.code,{children:"token"})," endpoint."]})})]})}function p(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var i=t(6540);const d={},o=i.createContext(d);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);